<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Immacare+</title>
  <link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/bootstrap-icons/font/bootstrap-icons.min.css" />

  <script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/jquery/jquery.min.js"></script>

  <script src="/js/print-utils.js"></script>
  <script src="dashboard.js"></script>
  <link rel="stylesheet" href="/datatables.net-dt/css/dataTables.dataTables.css" />
  <script src="/datatables.net/js/dataTables.js"></script>
  <script src="/datatables.net/js/dataTables.min.js"></script>
  <link rel="stylesheet" href="dashboard.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <h2>Dashboard</h2>

  <div class="row g-2">
    <div class="col-md-3">
      <div class="card">
        <div class="card-header card1header">No. of Patients today</div>
        <div class="card-body d-flex justify-content-between align-items-center card1body">
          <span id="patientTodayCount">Loading...</span>
          <i class="bi bi-file-earmark-person opacity-50"></i>
        </div>
        <div class="card-footer text-end footer-clickable card1footer" onclick="PatientToday()">
          More Info <i class="bi bi-arrow-right-circle"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card">
        <div class="card-header card2header">No. of Booking</div>
        <div class="card-body d-flex justify-content-between align-items-center card2body">
          <span id="appointmentCount">Loading..</span>
          <i class="bi bi-journal-check opacity-50"></i>
        </div>

        <div class="card-footer text-end footer-clickable card2footer" onclick="Bookings()">
          More Info <i class="bi bi-arrow-right-circle"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card">
        <div class="card-header card3header">No. of Items in Inventory</div>
        <div class="card-body d-flex justify-content-between align-items-center card3body">
          <span id="inventoryCount">0</span>
          <i class="bi bi-box-seam opacity-50"></i>
        </div>
        <div class="card-footer text-end footer-clickable card3footer" onclick="getInventory()">
          More Info <i class="bi bi-arrow-right-circle"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card">
        <div class="card-header card4header">Overall Patients</div>
        <div class="card-body d-flex justify-content-between align-items-center card4body">
          <span id="patientCount">Loading...</span>
          <i class="bi bi-people-fill opacity-50"></i>
        </div>
        <div class="card-footer text-end footer-clickable card4footer" onclick="getAllPatients()">
          More Info <i class="bi bi-arrow-right-circle"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Second Row of Dashboard Cards -->
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <div class="card">
        <div class="card-header" style="background-color: #28a745; color: white;">Completed Today</div>
        <div class="card-body d-flex justify-content-between align-items-center" style="background-color: #d4edda;">
          <span id="completedTodayCount">0</span>
          <i class="bi bi-check-circle opacity-50"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card">
        <div class="card-header" style="background-color: #ffc107; color: #333;">In Queue</div>
        <div class="card-body d-flex justify-content-between align-items-center" style="background-color: #fff3cd;">
          <span id="inQueueCount">0</span>
          <i class="bi bi-hourglass-split opacity-50"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card">
        <div class="card-header" style="background-color: #dc3545; color: white;">Cancelled</div>
        <div class="card-body d-flex justify-content-between align-items-center" style="background-color: #f8d7da;">
          <span id="cancelledCount">0</span>
          <i class="bi bi-x-circle opacity-50"></i>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card">
        <div class="card-header" style="background-color: #6f42c1; color: white;">Total Doctors</div>
        <div class="card-body d-flex justify-content-between align-items-center" style="background-color: #e2d9f3;">
          <span id="doctorCount">0</span>
          <i class="bi bi-person-badge opacity-50"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Predictive Analytics Section (Admin Only) -->
  <div id="predictiveAnalyticsSection" style="display: none;">
    <!-- Section Header Card -->
    <div class="card mt-3 shadow-sm">
      <div class="card-header d-flex justify-content-between align-items-center"
        style="background-color: #17a2b8; color: white;">
        <h5 class="mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Predictive Analytics</h5>
        <a href="../analytics/analytics.html" class="btn btn-light btn-sm">
          <i class="bi bi-box-arrow-up-right me-1"></i>Open Full Analytics
        </a>
      </div>
      <div class="card-body">
        <!-- Analytics Charts Row 1 -->
        <div class="row g-3">
          <!-- Appointment Forecasting Card -->
          <div class="col-lg-4">
            <div class="card h-100 border">
              <div class="card-header bg-primary text-white py-2">
                <h6 class="mb-0"><i class="bi bi-calendar-check me-2"></i>Appointment Forecast</h6>
              </div>
              <div class="card-body">
                <div style="height: 220px;">
                  <canvas id="dashboardAppointmentChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Inventory Prediction Card -->
          <div class="col-lg-4">
            <div class="card h-100 border">
              <div class="card-header bg-success text-white py-2">
                <h6 class="mb-0"><i class="bi bi-box-seam me-2"></i>Inventory Prediction</h6>
              </div>
              <div class="card-body">
                <div style="height: 220px;">
                  <canvas id="dashboardInventoryChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Patient Health Risk Card -->
          <div class="col-lg-4">
            <div class="card h-100 border">
              <div class="card-header bg-warning text-dark py-2">
                <h6 class="mb-0"><i class="bi bi-heart-pulse me-2"></i>Patient Health Risk</h6>
              </div>
              <div class="card-body">
                <div style="height: 220px;">
                  <canvas id="dashboardHealthChart"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Inventory Transactions Section -->
  <div id="inventoryTransactionsSection" class="card mt-3 shadow-sm" style="display: none;">
    <div class="card-header d-flex justify-content-between align-items-center"
      style="background-color: #6c757d; color: white;">
      <h5 class="mb-0"><i class="bi bi-clock-history me-2"></i>Recent Inventory Transactions</h5>
      <a href="../audit_logs/audit_logs.html" class="btn btn-light btn-sm">
        <i class="bi bi-box-arrow-up-right me-1"></i>View All
      </a>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table id="inventoryTransactionsTable" class="table table-striped table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>Date & Time</th>
              <th>Item</th>
              <th>Category</th>
              <th>Type</th>
              <th>Change</th>
              <th>Performed By</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="inventoryTransactionsBody">
            <tr>
              <td colspan="7" class="text-center text-muted py-3">Loading transactions...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <hr />

  <!-- Print Button for Dashboard Table -->
  <div class="d-flex justify-content-end mb-2">
    <button type="button" class="btn btn-secondary btn-sm" onclick="printDashboardTable()" title="Print Current View">
      <i class="bi bi-printer"></i> Print
    </button>
  </div>

  <table id="dashboardTable" class="table table-light table-striped table-bordered table-hover">
    <thead></thead>
    <tbody></tbody>
  </table>
</body>

</html>